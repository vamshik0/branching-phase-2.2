{
  "id": "7b9e09c2-88e4-4693-81f3-471dc9740f64",
  "name": "updateRewardRequestGenerator",
  "options": {
    "code": "const rewardName = rewardNameInputEditFlow.value;\nconst templateId = rewardOfferTemplateIdEditFlow.value;\nconst rewardType = rewardTypeInputEditFlow.value;\nconst rewardDescription = rewardDescriptionInputEditFlow.value.split(\",\");\nconst rewardDuration = rewardDurationEditFlow.value;\n\nlet rewardPresentationData = [{}, {}, {}, {}]; // Ensuring there are objects to update\n// For Locked fields\nrewardPresentationData[0].info_type = 1;\nrewardPresentationData[0].title = rewardLockedHeadingEditFlow.value;\nrewardPresentationData[0].description = rewardLockedDescriptionEditFlow.value;\nrewardPresentationData[0].cta = {}; // Ensure there's an object for cta\nrewardPresentationData[0].cta.text = rewardLockedCtaCalloutEditFlow.value;\nrewardPresentationData[0].cta.link = rewardLockedCtaLinkEditFlow.value;\n\n// For Unlocked fields\nrewardPresentationData[1].info_type = 2;\nrewardPresentationData[1].title = rewardUnlockedHeadingEditFlow.value;\nrewardPresentationData[1].description = rewardUnlockedDescriptionEditFlow.value;\nrewardPresentationData[1].cta = {}; // Ensure there's an object for cta\nrewardPresentationData[1].cta.text = rewardUnlockedCtaCalloutEditFlow.value;\nrewardPresentationData[1].cta.link = rewardUnlockedCtaLinkEditFlow.value;\n\n// For Redeemed fields\nrewardPresentationData[3].info_type = 4;\nrewardPresentationData[3].title = rewardRedeemedHeadingEditFlow.value;\nrewardPresentationData[3].description = rewardRedeemedDescriptionEditFlow.value;\nrewardPresentationData[3].cta = {}; // Ensure there's an object for cta\nrewardPresentationData[3].cta.text = rewardRedeemedCtaCalloutEditFlow.value;\nrewardPresentationData[3].cta.link = rewardRedeemedCtaLinkEditFlow.value;\n\n// For Expired fields\nrewardPresentationData[2].info_type = 3;\nrewardPresentationData[2].title = rewardExpiredHeadingEditFlow.value;\nrewardPresentationData[2].description = rewardExpiredDescriptionEditFlow.value;\nrewardPresentationData[2].cta = {}; // Ensure there's an object for cta\nrewardPresentationData[2].cta.text = rewardExpiredCtaCalloutEditFlow.value;\nrewardPresentationData[2].cta.link = rewardExpiredCtaLinkEditFlow.value;\n\nconst rewardTypeEnum = {\n  REWARD_TYPE_INVALID: 0,\n  REWARD_TYPE_OFFER: 1,\n  REWARD_TYPE_LOYALTY_SUBSCRIPTION: 2,\n};\n\nlet benefitData;\n\nif (rewardType === \"REWARD_TYPE_OFFER\") {\n  benefitData = {\n    reward_type: rewardTypeEnum[rewardType],\n    offer_data: {\n      template_id: templateId,\n      offer_duration: daysToDuration(rewardDuration),\n    },\n  };\n} else if (rewardType === \"REWARD_TYPE_LOYALTY_SUBSCRIPTION\") {\n  benefitData = {\n    reward_type: rewardTypeEnum[rewardType],\n    swiggy_one_data: {\n      plan_id: templateId,\n      plan_duration: daysToDuration(rewardDuration),\n    },\n  };\n} else {\n  benefitData = {\n    reward_type: rewardTypeEnum[\"REWARD_TYPE_INVALID\"],\n  };\n}\n\n// Function to generate UUID\nfunction generateUUID() {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (Math.random() * 16) | 0,\n      v = c === \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\n// Function to get current time in seconds and nanoseconds\nfunction getCurrentTime() {\n  const now = new Date();\n  const seconds = Math.floor(now.getTime() / 1000);\n  const nanos = (now.getTime() % 1000) * 1e6; // convert remaining milliseconds to nanoseconds\n  return {\n    seconds: seconds,\n    nanos: nanos,\n  };\n}\n\n//function to convert days into google duration\nfunction daysToDuration(days) {\n  const SECONDS_IN_A_DAY = 86400;\n\n  // Convert days to total seconds\n  let totalSeconds = days * SECONDS_IN_A_DAY;\n\n  return {\n    seconds: totalSeconds,\n    nanos: 0,\n  };\n}\n\n//function to convert date into google timestamp\nfunction convertToTimestamp(dateString) {\n  // Parse the date string\n  const date = new Date(dateString + \"T00:00:00Z\");\n\n  // Compute seconds since Unix epoch\n  const seconds = Math.floor(date.getTime() / 1000);\n\n  return {\n    seconds: seconds,\n    nanos: 0,\n  };\n}\n\nfunction stringToUUID(str) {\n  function s4(hash) {\n    return Math.floor((1 + hash) * 0x10000)\n      .toString(16)\n      .substring(1);\n  }\n\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    hash = str.charCodeAt(i) + ((hash << 5) - hash);\n  }\n\n  // Split hash into parts and use them to format UUID\n  return (\n    s4(hash & 0xffff) +\n    s4((hash >>> 16) & 0xffff) +\n    \"-\" +\n    s4(hash & 0xffff) +\n    \"-\" +\n    s4((hash >>> 16) & 0xffff) +\n    \"-\" +\n    s4(hash & 0xffff) +\n    \"-\" +\n    s4(hash & 0xffff) +\n    s4((hash >>> 16) & 0xffff)\n  );\n}\n\nconst rewardData = {\n  reward_id: getMilestoneReward.data.milestone_reward.reward_id,\n  reward_name: rewardName,\n  reward_description: rewardDescription,\n  is_active: getMilestoneReward.data.milestone_reward.is_active,\n  created_by: getMilestoneReward.data.milestone_reward.created_by,\n  created_at: getMilestoneReward.data.milestone_reward.created_at,\n  reward_data: {\n    benefit_data: benefitData,\n    reward_presentation_data: rewardPresentationData,\n  },\n};\n\nconst jsonData = {\n  request_context: {\n    request_id: generateUUID(),\n    request_time: getCurrentTime(),\n    client_id: stringToUUID(\"Marketing Dashboard\"),\n    channel: \"SWIGGY\",\n  },\n  market_place_context: {\n    marketplace_id: \"SWIGGY_IN\",\n    business_line_id: \"INSTAMART\",\n  },\n  milestone_reward: rewardData,\n  updated_by: current_user.email,\n};\n\nreturn JSON.stringify(jsonData);\n",
    "parameters": [],
    "runOnPageLoad": false
  },
  "dataSourceId": "424c9bde-1c88-4787-af40-e905d3ecfd6c",
  "appVersionId": "d74f28e3-ec1b-4ff9-b6e6-b777a4e48b56"
}