{
  "id": "a7c1f46b-3fb3-470a-b224-13e346e5e5fc",
  "name": "createCampaignRequestGenerator",
  "options": {
    "code": "const campaignStartDateValue = campaignStartDate.value;\nconst campaignEndDateValue = campaignEndDate.value;\nconst campaignDuration = userJourneyDuration.value;\nconst userSegments = eligibleUserSegmentData.value;\nconst ineligibleUserSegments = ineligibleUserSegmentData.value;\nconst eligibleXps = eligibleXpVariants.value.split(\",\");\nconst ineligibleXps = ineligibleXpVariants.value.split(\",\");\nconst isBulkUploadEnabled = citiesBulkUploadCheckbox.value;\nconst eligibleCities = isBulkUploadEnabled\n  ? citiesBulkUploadFileInput.parsedValue?.[0]?.map(city => city.CityIds) || []\n  : eligibleCitiesData.value;\nconst ineligibleCities = ineligibleCitiesData.value;\n\n//  Function to generate UUID\nfunction generateUUID() {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (Math.random() * 16) | 0,\n      v = c === \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\n// Function to get current time in seconds and nanoseconds\nfunction getCurrentTime() {\n  const now = new Date();\n  const seconds = Math.floor(now.getTime() / 1000);\n  const nanos = (now.getTime() % 1000) * 1e6; // convert remaining milliseconds to nanoseconds\n  return {\n    seconds: seconds,\n    nanos: nanos,\n  };\n}\n\n//function to convert days into google duration\nfunction daysToDuration(days) {\n  const SECONDS_IN_A_DAY = 86400;\n\n  // Convert days to total seconds\n  let totalSeconds = days * SECONDS_IN_A_DAY;\n\n  return {\n    seconds: totalSeconds,\n    nanos: 0,\n  };\n}\n\n//function to convert date into google timestamp\nfunction convertToTimestamp(dateString) {\n  // Check if dateString includes time or is just a date\n  if (dateString.includes('T') || dateString.includes(':')) {\n    // Parse as full datetime string\n    date = new Date(dateString);\n  } else {\n    // Parse as date-only string, adding time and timezone to ensure consistency\n    date = new Date(dateString + \"T00:00:00Z\");\n  }\n\n  // Compute seconds since Unix epoch\n  const seconds = Math.floor(date.getTime() / 1000);\n\n  return {\n    seconds: seconds,\n    nanos: 0,\n  };\n}\n\nfunction stringToUUID(str) {\n  function s4(hash) {\n    return Math.floor((1 + hash) * 0x10000)\n      .toString(16)\n      .substring(1);\n  }\n\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    hash = str.charCodeAt(i) + ((hash << 5) - hash);\n  }\n\n  // Split hash into parts and use them to format UUID\n  return (\n    s4(hash & 0xffff) +\n    s4((hash >>> 16) & 0xffff) +\n    \"-\" +\n    s4(hash & 0xffff) +\n    \"-\" +\n    s4((hash >>> 16) & 0xffff) +\n    \"-\" +\n    s4(hash & 0xffff) +\n    \"-\" +\n    s4(hash & 0xffff) +\n    s4((hash >>> 16) & 0xffff)\n  );\n}\n\nconst campaignData = {\n  campaign_start_time: convertToTimestamp(campaignStartDateValue),\n  campaign_end_time: convertToTimestamp(campaignEndDateValue),\n  user_journey_duration: daysToDuration(campaignDuration),\n  campaign_milestone_data: rewards.value?.map((item) => {\n    return {\n      reward_id: item.reward_id,\n      milestone_eligibility_criteria: {\n        reward_redeem_order_count: item.reward_redeem_order_count,\n      },\n    };\n  }),\n  user_segment_data: {\n    eligible_user_segment_info: {\n      segments: userSegments,\n    },\n    ineligible_user_segment_info: {\n      segments: ineligibleUserSegments,\n    },\n  },\n  experiment_data: {\n    eligible_xp_variants: eligibleXps,\n    ineligible_xp_variants: ineligibleXps,\n  },\n  city_data: {\n    eligible_cities: eligibleCities,\n    ineligible_cities: ineligibleCities,\n  },\n};\n\nconst jsonData = {\n  request_context: {\n    request_id: generateUUID(),\n    request_time: getCurrentTime(),\n    client_id: stringToUUID(\"Marketing Dashboard\"),\n    channel: \"SWIGGY\",\n  },\n  market_place_context: {\n    marketplace_id: \"SWIGGY_IN\",\n    business_line_id: \"INSTAMART\",\n  },\n  milestone_campaign: campaignData,\n  created_by: current_user.email,\n};\n\nreturn JSON.stringify(jsonData);\n",
    "parameters": [],
    "runOnPageLoad": false
  },
  "dataSourceId": "424c9bde-1c88-4787-af40-e905d3ecfd6c",
  "appVersionId": "d74f28e3-ec1b-4ff9-b6e6-b777a4e48b56"
}